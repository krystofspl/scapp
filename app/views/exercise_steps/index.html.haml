- content_for :heading do
  = @exercise.name + ' - ' + t('exercise_steps.list')

.row
  .col-sm-12
    .box.box-primary
      .box-header
        %h2.box-title= t('exercise_steps.list')
      .box-body
        .row
          .col-sm-12
            - unless @exercise_steps.empty?
              %table#sortable.table
                %tbody
                  %tr
                    %th.col-sm-3= t('dictionary.name')
                    %th.col-sm-7= t('dictionary.description')
                    %th.col-sm-2
                  - @exercise_steps.each do |exercise_step|
                    %tr.item{:data => {'item-id' => exercise_step.id},:style=>'cursor:pointer;'}
                      %td
                        %span.fa.fa-arrows
                        %strong= exercise_step.name
                      %td= exercise_step.description
                      %td
                        = link_to edit_exercise_step_path(:exercise_step_id => exercise_step.id), class: 'btn btn-warning btn-xs' do
                          %i.fa.fa-remove
                          = t('dictionary.edit')
                        = link_to exercise_steps_path(:exercise_step_id => exercise_step.id), class: 'btn btn-danger btn-xs', :method => :delete, :data => { :confirm => 'Are you sure?' } do
                          %i.fa.fa-remove
                          = t('dictionary.delete')
            - else
              = t('exercise_steps.empty')
.row
  .col-sm-12
    .box.box-primary
      .box-header
        %h2.box-title= t('exercise_steps.add_new')
      .box-body
        .row
          .col-sm-4
            = render 'form'

:coffeescript
  rows_sorting = ->
    table_width = $('#sortable').width()
    cells = $('#sortable').find('tr')[0].cells.length
    desired_width = (table_width / cells) + 'px'
    $('.table td').css('width', desired_width)
    $('#sortable').sortable(
      axis: 'y'
      items: '.item'
      cursor: 'move'

      sort: (e, ui) ->
        ui.item.addClass('active-item-shadow')
      stop: (e, ui) ->
        ui.item.removeClass('active-item-shadow')
        ui.item.children('td').effect('highlight', {}, 1000)
      update: (e, ui) ->
        item_id = ui.item.data('item-id')
        console.log(item_id)
        position = ui.item.index()-1
        $.ajax(
          type: 'POST'
          url: '#{url_for(update_row_order_exercise_steps_url)}'
          dataType: 'json'
          data: { exercise_step: {exercise_step_id: item_id, row_order_position: position } }
        )
    )
  do f = ->
    rows_sorting()
